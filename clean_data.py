# -*- coding: utf-8 -*-
"""Hydro

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1yT26rXgW0b9mJSD2ds8nWiIFyZrXcizH
"""

import pandas as pd

"""# Data Preprocessing"""

total_data = pd.read_csv('samples_method3.csv',sep=';')

total_data

"""## Choosing Data for a specific station"""

data = total_data

data = data.sort_values(['Sample Date','GEMS Station Number'])

data

clean_data = {}

data.info()

keys = ['TEMP','pH','TURB','FECALCOLI','NO3N','TP']
weights = [0.10,0.11,0.08,0.16,0.10,0.07]

# clean_data['Station Number'] = []
# clean_data['wqi'] = []
# clean_data['Station and Date'] = []
clean_data['ID'] = []
clean_data['Date'] = []
for k in keys:
  clean_data[k] = []

clean_data.keys()

def WQI(x,weights):
  wqi = 0
  t = 0
  for i in range(len(weights)):
    wqi = wqi + weights[i]*x[i]
    t = t + weights[i]

  return wqi/t
### 1 - V.Bad; 2 - Bad; 3 - Medium; 4 - Good; 5 - Excellent
def WQC(x):
  if x >= 0 and x <= 25:
    return 0
  if x > 25 and x <= 50:
    return 1
  if x > 50 and x <= 70:
    return 2
  if x > 70 and x <= 90:
    return 3
  return 4

def normalize_q(q_ph, q_temp, q_turb, q_nitrates, q_phosphate, q_coli):

    q_norm_ph = 0
    q_norm_temp = 0
    q_norm_turb = 0
    q_norm_nitrates = 0
    q_norm_phosphate = 0
    q_norm_coli = 0

    if (q_ph >= 0 and q_ph < 2) or (q_ph > 12 and q_ph <= 14):
        q_norm_ph = 0
    elif (q_ph >= 2 and q_ph < 3) or (q_ph > 11 and q_ph <= 12):
        q_norm_ph = 2
    elif (q_ph >= 3 and q_ph < 4):
        q_norm_ph = 4
    elif (q_ph >= 4 and q_ph < 5):
        q_norm_ph = 8
    elif (q_ph >= 4 and q_ph < 5):
        q_norm_ph = 24
    elif (q_ph >= 5 and q_ph < 6):
        q_norm_ph = 55
    elif (q_ph >= 6 and q_ph < 7):
        q_norm_ph = 90
    elif (q_ph >= 7 and q_ph < 7.2):
        q_norm_ph = 92
    elif (q_ph >= 7.2 and q_ph < 7.5):
        q_norm_ph = 93
    elif (q_ph >= 7.5 and q_ph < 7.7):
        q_norm_ph = 90
    elif (q_ph >= 7.7 and q_ph < 8):
        q_norm_ph = 82
    elif (q_ph >= 8 and q_ph < 8.5):
        q_norm_ph = 67
    elif (q_ph >= 8.5 and q_ph < 9):
        q_norm_ph = 47
    elif (q_ph >= 9 and q_ph < 10):
        q_norm_ph = 19
    elif (q_ph >= 10 and q_ph < 11):
        q_norm_ph = 7

    if (q_temp < -10):
        q_norm_temp = 56
    elif (q_temp >= -10 and q_temp < -7.5):
        q_norm_temp = 63
    elif (q_temp >= -7.5 and q_temp < -5):
        q_norm_temp = 73
    elif (q_temp >= -5 and q_temp < -2.5):
        q_norm_temp = 85
    elif (q_temp >= -2.5 and q_temp < -1):
        q_norm_temp = 90
    elif (q_temp >= -1 and q_temp < 0):
        q_norm_temp = 93
    elif (q_temp >= 0 and q_temp < 1):
        q_norm_temp = 89
    elif (q_temp >= 1 and q_temp < 2.5):
        q_norm_temp = 85
    elif (q_temp >= 2.5 and q_temp < 5):
        q_norm_temp = 72
    elif (q_temp >= 5 and q_temp < 7.5):
        q_norm_temp = 57
    elif (q_temp >= 7.5 and q_temp < 10):
        q_norm_temp = 44
    elif (q_temp >= 10 and q_temp < 12.5):
        q_norm_temp = 36
    elif (q_temp >= 12.5 and q_temp < 15):
        q_norm_temp = 28
    elif (q_temp >= 15 and q_temp < 17.5):
        q_norm_temp = 23
    elif (q_temp >= 17.5 and q_temp < 20):
        q_norm_temp = 21
    elif (q_temp >= 20 and q_temp < 22.5):
        q_norm_temp = 18
    elif (q_temp >= 22.5 and q_temp < 25):
        q_norm_temp = 15
    elif (q_temp >= 25 and q_temp < 27.5):
        q_norm_temp = 12
    elif (q_temp >= 27.5 and q_temp < 30):
        q_norm_temp = 10

    if q_turb < 0:
        q_norm_turb = 97
    elif (q_turb >= 0 and q_turb < 5):
        q_norm_turb = 84
    elif (q_turb >= 5 and q_turb < 10):
        q_norm_turb = 76
    elif (q_turb >= 10 and q_turb < 15):
        q_norm_turb = 68
    elif (q_turb >= 15 and q_turb < 20):
        q_norm_turb = 62
    elif (q_turb >= 20 and q_turb < 25):
        q_norm_turb = 57
    elif (q_turb >= 25 and q_turb < 30):
        q_norm_turb = 53
    elif (q_turb >= 30 and q_turb < 35):
        q_norm_turb = 48
    elif (q_turb >= 35 and q_turb < 40):
        q_norm_turb = 45
    elif (q_turb >= 40 and q_turb < 50):
        q_norm_turb = 39
    elif (q_turb >= 50 and q_turb < 60):
        q_norm_turb = 34
    elif (q_turb >= 60 and q_turb < 70):
        q_norm_turb = 28
    elif (q_turb >= 70 and q_turb < 80):
        q_norm_turb = 25
    elif (q_turb >= 80 and q_turb < 90):
        q_norm_turb = 22
    elif (q_turb >= 90 and q_turb < 100):
        q_norm_turb = 17
    elif q_turb >= 100:
        q_norm_turb = 5

    if q_nitrates < 0:
        q_norm_nitrates = 98
    elif (q_nitrates >= 0 and q_nitrates < 0.25):
        q_norm_nitrates = 97
    elif (q_nitrates >= 0.25 and q_nitrates < 0.5):
        q_norm_nitrates = 96
    elif (q_nitrates >= 0.5 and q_nitrates < 0.75):
        q_norm_nitrates = 95
    elif (q_nitrates >= 0.75 and q_nitrates < 1):
        q_norm_nitrates = 94
    elif (q_nitrates >= 1 and q_nitrates < 1.5):
        q_norm_nitrates = 92
    elif (q_nitrates >= 1.5 and q_nitrates < 2):
        q_norm_nitrates = 90
    elif (q_nitrates >= 2 and q_nitrates < 3):
        q_norm_nitrates = 85
    elif (q_nitrates >= 3 and q_nitrates < 4):
        q_norm_nitrates = 70
    elif (q_nitrates >= 4 and q_nitrates < 5):
        q_norm_nitrates = 65
    elif (q_nitrates >= 5 and q_nitrates < 10):
        q_norm_nitrates = 51
    elif (q_nitrates >= 10 and q_nitrates < 15):
        q_norm_nitrates = 43
    elif (q_nitrates >= 15 and q_nitrates < 20):
        q_norm_nitrates = 37
    elif (q_nitrates >= 20 and q_nitrates < 30):
        q_norm_nitrates = 24
    elif (q_nitrates >= 30 and q_nitrates < 40):
        q_norm_nitrates = 17
    elif (q_nitrates >= 40 and q_nitrates < 50):
        q_norm_nitrates = 7
    elif (q_nitrates >= 50 and q_nitrates < 60):
        q_norm_nitrates = 5
    elif (q_nitrates >= 60 and q_nitrates < 70):
        q_norm_nitrates = 4
    elif (q_nitrates >= 70 and q_nitrates < 80):
        q_norm_nitrates = 3
    elif (q_nitrates >= 80 and q_nitrates < 90):
        q_norm_nitrates = 2
    elif q_nitrates >= 90:
        q_norm_nitrates = 1
    
    if q_phosphate < 0:
        q_norm_phosphate = 99
    elif (q_phosphate >= 0 and q_phosphate < 0.05):
        q_norm_phosphate = 98
    elif (q_phosphate >= 0.05 and q_phosphate < 0.1):
        q_norm_phosphate = 97
    elif (q_phosphate >= 0.1 and q_phosphate < 0.2):
        q_norm_phosphate = 95
    elif (q_phosphate >= 0.2 and q_phosphate < 0.3):
        q_norm_phosphate = 90
    elif (q_phosphate >= 0.3 and q_phosphate < 0.4):
        q_norm_phosphate = 78
    elif (q_phosphate >= 0.4 and q_phosphate < 0.5):
        q_norm_phosphate = 60
    elif (q_phosphate >= 0.5 and q_phosphate < 0.75):
        q_norm_phosphate = 50
    elif (q_phosphate >= 0.75 and q_phosphate < 1):
        q_norm_phosphate = 39
    elif (q_phosphate >= 1 and q_phosphate < 1.5):
        q_norm_phosphate = 30
    elif (q_phosphate >= 1.5 and q_phosphate < 2):
        q_norm_phosphate = 26
    elif (q_phosphate >= 2 and q_phosphate < 3):
        q_norm_phosphate = 21
    elif (q_phosphate >= 3 and q_phosphate < 4):
        q_norm_phosphate = 16
    elif (q_phosphate >= 4 and q_phosphate < 5):
        q_norm_phosphate = 12
    elif (q_phosphate >= 5 and q_phosphate < 6):
        q_norm_phosphate = 10
    elif (q_phosphate >= 6 and q_phosphate < 7):
        q_norm_phosphate = 8
    elif (q_phosphate >= 7 and q_phosphate < 8):
        q_norm_phosphate = 7
    elif (q_phosphate >= 8 and q_phosphate < 9):
        q_norm_phosphate = 6
    elif (q_phosphate >= 9 and q_phosphate < 10):
        q_norm_phosphate = 5
    elif q_phosphate >= 10:
        q_norm_phosphate = 2

    if (q_coli >= 0 and q_coli < 1):
        q_norm_coli = 98
    elif (q_coli >= 1 and q_coli < 2):
        q_norm_coli = 89
    elif (q_coli >= 2 and q_coli < 5):
        q_norm_coli = 80
    elif (q_coli >= 5 and q_coli < 10):
        q_norm_coli = 71
    elif (q_coli >= 10 and q_coli < 20):
        q_norm_coli = 63
    elif (q_coli >= 20 and q_coli < 50):
        q_norm_coli = 53
    elif (q_coli >= 50 and q_coli < 100):
        q_norm_coli = 45
    elif (q_coli >= 100 and q_coli < 200):
        q_norm_coli = 37
    elif (q_coli >= 200 and q_coli < 500):
        q_norm_coli = 27
    elif (q_coli >= 500 and q_coli < 1000):
        q_norm_coli = 22
    elif (q_coli >= 1000 and q_coli < 2000):
        q_norm_coli = 18
    elif (q_coli >= 2000 and q_coli < 5000):
        q_norm_coli = 13
    elif (q_coli >= 5000 and q_coli < 10000):
        q_norm_coli = 10
    elif (q_coli >= 10000 and q_coli < 20000):
        q_norm_coli = 8
    elif (q_coli >= 20000 and q_coli < 50000):
        q_norm_coli = 5
    elif (q_coli >= 50000 and q_coli < 100000):
        q_norm_coli = 3
    elif q_coli >= 100000:
        q_norm_coli = 2

    return q_norm_ph, q_norm_temp, q_norm_turb, q_norm_nitrates, q_norm_phosphate, q_norm_coli

l = 1
for ind in data.index:
  if len(clean_data['Date']) == 0:
    if data['Parameter Code'][ind] in keys:
      clean_data[data['Parameter Code'][ind]].append(data['Value'][ind])
    clean_data['Date'].append(data['Sample Date'][ind])
    clean_data['ID'].append(str(data['Sample Date'][ind])+str(data['GEMS Station Number'][ind]))
    continue

  if str(data['Sample Date'][ind])+str(data['GEMS Station Number'][ind]) in clean_data['ID']:
    if data['Parameter Code'][ind] in keys:
      clean_data[data['Parameter Code'][ind]].append(data['Value'][ind])
  else:
    # print("Present " + str(clean_data['Date'][l-1]))
    # print("Next "+str(data['Sample Date'][ind]))
    for k in keys:
      if len(clean_data[k]) < l:
        # print(k)
        clean_data[k].append(0.0)
    l = l+1
    clean_data['Date'].append(data['Sample Date'][ind])
    clean_data['ID'].append(str(data['Sample Date'][ind])+str(data['GEMS Station Number'][ind]))
    if data['Parameter Code'][ind] in keys:
      clean_data[data['Parameter Code'][ind]].append(data['Value'][ind])
  

for k in keys:
  if len(clean_data[k]) < l:
    # print(k)
    clean_data[k].append(0.0)

clean_data = pd.DataFrame(clean_data)

clean_data

for i in clean_data.index:
  clean_data['pH'][i],clean_data['TEMP'][i],clean_data['TURB'][i],clean_data['NO3N'][i],clean_data['TP'][i],clean_data['FECALCOLI'][i] = normalize_q(clean_data['pH'][i],clean_data['TEMP'][i],clean_data['TURB'][i],clean_data['NO3N'][i],clean_data['TP'][i],clean_data['FECALCOLI'][i])

clean_data

"""## WQI and WQC Column"""

import numpy as np



X = clean_data.drop(['ID','Date'],1)

X = np.array(X)

X

WQI_VAL = []
label = []

for i in range(len(X)):
  WQI_VAL.append(WQI(X[i],weights))
  label.append(WQC(WQI(X[i],weights)))

clean_data['Label'] = label
clean_data['WQI'] = WQI_VAL

clean_data.to_csv('clean.csv')

clean_data